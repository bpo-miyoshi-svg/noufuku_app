import React, { useState, useEffect } from 'react';

/* --- アイコンコンポーネント (外部ライブラリ依存を排除) --- */
const IconPrinter = () => (
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
);
const IconCalculator = () => (
  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="2" width="16" height="20" rx="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="16" y1="14" x2="16" y2="14"></line><line x1="12" y1="14" x2="12" y2="14"></line><line x1="8" y1="14" x2="8" y2="14"></line><line x1="16" y1="18" x2="16" y2="18"></line><line x1="12" y1="18" x2="12" y2="18"></line><line x1="8" y1="18" x2="8" y2="18"></line></svg>
);
const IconFileText = () => (
  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
);
const IconTrash = () => (
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
);
const IconPlus = () => (
  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
);
const IconCheckSquare = () => (
  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>
);
const IconClock = () => (
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
);

export default function App() {
  /* --- State Management --- */
  const [meta, setMeta] = useState({
    crop: '',
    name: '',
    goal: '',
    planTask: '', 
    planMonthStart: '',
    planMonthEnd: '',
    planFreqType: '', 
    planFreqCount: '',
    planTimeStart: '',
    planTimeEnd: '',
    targetPrice: '',
    savedHours: ''
  });

  const [tasks, setTasks] = useState([
    { id: 1, name: '（例）枝豆の袋詰め・計量', isRepro: true, isSimple: true, isSafe: true, isValue: true, worker: '園主', wage: 2500, amount: 50, unit: '袋', isRequest: false }
  ]);

  /* 作業リストが変更されたら「依頼」にチェックが入っているものを抽出して「外注計画」に反映 */
  useEffect(() => {
    const requestedTasks = tasks.filter(t => t.isRequest);
    if (requestedTasks.length > 0) {
      const requestedTaskNames = requestedTasks.map(t => t.name).join('、');
      setMeta(prev => ({ ...prev, planTask: requestedTaskNames }));
    }
  }, [tasks]);

  /* 新しい行を追加 */
  const addTask = () => {
    const newId = tasks.length > 0 ? Math.max(...tasks.map(t => t.id)) + 1 : 1;
    setTasks([...tasks, { 
      id: newId, name: '', isRepro: false, isSimple: false, isSafe: false, isValue: false, worker: '', wage: '', amount: '', unit: '', isRequest: false 
    }]);
  };

  /* 行の削除 */
  const removeTask = (id) => {
    if (tasks.length === 1) {
      alert("最後の1行は削除できません（内容をクリアしてください）");
      return;
    }
    setTasks(tasks.filter(t => t.id !== id));
  };

  /* 入力値の更新 */
  const updateTask = (id, field, value) => {
    setTasks(tasks.map(t => t.id === id ? { ...t, [field]: value } : t));
  };

  /* メタデータの更新 */
  const updateMeta = (field, value) => {
    setMeta({ ...meta, [field]: value });
  };

  /* コスト計算 */
  const calculateCost = (wage, amount) => {
    if (!wage || !amount || amount == 0) return '';
    return Math.round(wage / amount);
  };

  /* 外注可否判定 (簡易ロジック: 全てチェックなら◎) */
  const getJudgment = (task) => {
    const score = (task.isRepro ? 1 : 0) + (task.isSimple ? 1 : 0) + (task.isSafe ? 1 : 0) + (task.isValue ? 1 : 0);
    if (score === 4) return '◎';
    if (score === 3) return '○';
    if (score === 2) return '△';
    return '×';
  };

  return (
    <div className="min-h-screen bg-gray-100 font-sans text-gray-800">
      
      {/* === 画面表示用 UI (印刷時は非表示) === */}
      <div className="print:hidden pb-20">
        
        {/* Header Navigation */}
        <header className="bg-green-800 text-white p-4 shadow-md sticky top-0 z-10">
          <div className="max-w-6xl mx-auto flex justify-between items-center">
            <h1 className="font-bold text-lg md:text-xl flex items-center gap-2">
              <IconCalculator />
              <span>農作業分解シミュレーター</span>
            </h1>
            <button 
              onClick={() => window.print()} 
              className="bg-white text-green-800 px-4 py-2 rounded-lg font-bold text-sm hover:bg-green-50 flex items-center gap-2 shadow transition"
            >
              <IconPrinter />
              <span className="hidden md:inline">PDF保存・印刷</span>
              <span className="md:hidden">印刷</span>
            </button>
          </div>
        </header>

        <main className="max-w-6xl mx-auto p-4 md:p-6 space-y-6">

          {/* 1. 基本情報入力エリア */}
          <section className="bg-white p-4 rounded-lg shadow border border-gray-200">
            <h2 className="text-green-800 font-bold border-b border-gray-200 pb-2 mb-4 flex items-center gap-2">
              <IconFileText /> 基本設定
            </h2>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
              <div>
                <label className="block text-xs text-gray-500 mb-1">品目名</label>
                <input 
                  type="text" 
                  className="w-full border border-gray-300 rounded p-2 focus:ring-2 focus:ring-green-500 outline-none" 
                  placeholder="例：枝豆、イチゴ"
                  value={meta.crop}
                  onChange={(e) => updateMeta('crop', e.target.value)}
                />
              </div>
              <div>
                <label className="block text-xs text-gray-500 mb-1">氏名 / 農園名</label>
                <input 
                  type="text" 
                  className="w-full border border-gray-300 rounded p-2 focus:ring-2 focus:ring-green-500 outline-none" 
                  placeholder="例：山田 太郎"
                  value={meta.name}
                  onChange={(e) => updateMeta('name', e.target.value)}
                />
              </div>
            </div>
            <div>
              <label className="block text-xs text-gray-500 mb-1">経営目標（なぜ外注するのか？）</label>
              <textarea 
                className="w-full border border-gray-300 rounded p-2 focus:ring-2 focus:ring-green-500 outline-none h-20 text-sm" 
                placeholder="例：販路開拓の時間を作る、家族との時間を確保する..."
                value={meta.goal}
                onChange={(e) => updateMeta('goal', e.target.value)}
              />
            </div>
          </section>

          {/* 2. 作業入力エリア */}
          <section className="space-y-4">
            <div className="flex justify-between items-center">
              <h2 className="text-lg font-bold text-gray-700">作業分解・コスト計算</h2>
            </div>

            {/* PC View (Table) */}
            <div className="hidden md:block bg-white rounded-lg shadow overflow-hidden border border-gray-200">
              <table className="w-full text-sm text-left">
                <thead className="bg-gray-100 text-gray-600 font-bold border-b border-gray-200">
                  <tr>
                    <th className="p-2 w-1/4">作業工程</th>
                    <th className="p-1 text-center w-8 text-xs">再現</th>
                    <th className="p-1 text-center w-8 text-xs">簡単</th>
                    <th className="p-1 text-center w-8 text-xs">安全</th>
                    <th className="p-1 text-center w-8 text-xs">価値</th>
                    <th className="p-2 w-28">作業者/時給</th>
                    <th className="p-2 w-20">1時間量</th>
                    <th className="p-2 w-16">単位</th>
                    <th className="p-2 w-20">単価(円)</th>
                    <th className="p-2 text-center w-12">判定</th>
                    <th className="p-2 text-center w-12 bg-green-50 text-green-800">依頼</th>
                    <th className="p-2 text-center w-10"></th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-gray-100">
                  {tasks.map((task) => (
                    <tr key={task.id} className="hover:bg-gray-50 transition">
                      <td className="p-2">
                        <input 
                          type="text" 
                          className="w-full p-1 border rounded bg-transparent focus:bg-white" 
                          placeholder="作業名"
                          value={task.name}
                          onChange={(e) => updateTask(task.id, 'name', e.target.value)}
                        />
                      </td>
                      {['isRepro', 'isSimple', 'isSafe', 'isValue'].map(key => (
                        <td key={key} className="p-1 text-center">
                          <input 
                            type="checkbox" 
                            checked={task[key]} 
                            onChange={(e) => updateTask(task.id, key, e.target.checked)}
                            className="w-4 h-4 text-green-600 rounded focus:ring-green-500 cursor-pointer"
                          />
                        </td>
                      ))}
                      <td className="p-2">
                        <div className="flex gap-1 mb-1">
                          <input 
                            type="text" 
                            className="w-full text-xs p-1 border rounded"
                            placeholder="誰"
                            value={task.worker}
                            onChange={(e) => updateTask(task.id, 'worker', e.target.value)}
                          />
                        </div>
                        <div className="flex items-center">
                          <span className="text-xs text-gray-400 mr-1">¥</span>
                          <input 
                            type="number" 
                            className="w-full text-xs p-1 border rounded"
                            placeholder="時給"
                            value={task.wage}
                            onChange={(e) => updateTask(task.id, 'wage', e.target.value)}
                          />
                        </div>
                      </td>
                      <td className="p-2">
                        <input 
                          type="number" 
                          className="w-full p-1 border rounded"
                          placeholder="数量"
                          value={task.amount}
                          onChange={(e) => updateTask(task.id, 'amount', e.target.value)}
                        />
                      </td>
                      <td className="p-2">
                        <input 
                          type="text" 
                          className="w-full p-1 border rounded"
                          placeholder="個/kg"
                          value={task.unit}
                          onChange={(e) => updateTask(task.id, 'unit', e.target.value)}
                        />
                      </td>
                      <td className="p-2 font-bold text-right text-gray-700">
                        {calculateCost(task.wage, task.amount) ? `¥${calculateCost(task.wage, task.amount)}` : '-'}
                      </td>
                      <td className="p-2 text-center text-lg font-bold text-green-700">
                        {getJudgment(task)}
                      </td>
                      <td className="p-2 text-center bg-green-50">
                        <input 
                          type="checkbox" 
                          checked={task.isRequest} 
                          onChange={(e) => updateTask(task.id, 'isRequest', e.target.checked)}
                          className="w-5 h-5 text-green-600 rounded focus:ring-green-500 cursor-pointer"
                        />
                      </td>
                      <td className="p-2 text-center">
                        <button onClick={() => removeTask(task.id)} className="text-gray-400 hover:text-red-500">
                          <IconTrash />
                        </button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

            {/* Mobile View (Cards) */}
            <div className="md:hidden space-y-4">
              {tasks.map((task) => (
                <div key={task.id} className={`bg-white p-4 rounded-lg shadow border-l-4 relative ${task.isRequest ? 'border-green-600 bg-green-50' : 'border-gray-300'}`}>
                   <button 
                      onClick={() => removeTask(task.id)} 
                      className="absolute top-2 right-2 text-gray-300 hover:text-red-500"
                    >
                      <IconTrash />
                    </button>
                  <div className="mb-3 pr-8">
                    <div className="flex items-center gap-2 mb-1">
                      <label className="flex items-center gap-1 cursor-pointer bg-white px-2 py-1 rounded border border-green-200 shadow-sm">
                        <input 
                          type="checkbox" 
                          checked={task.isRequest} 
                          onChange={(e) => updateTask(task.id, 'isRequest', e.target.checked)}
                          className="w-4 h-4 text-green-600"
                        />
                        <span className="text-xs font-bold text-green-800">依頼する</span>
                      </label>
                      <span className="text-xs text-gray-500">作業名:</span>
                    </div>
                    <input 
                      type="text" 
                      className="w-full border-b border-gray-300 p-1 focus:border-green-500 outline-none font-bold"
                      placeholder="例：枝豆の袋詰め"
                      value={task.name}
                      onChange={(e) => updateTask(task.id, 'name', e.target.value)}
                    />
                  </div>
                  
                  <div className="grid grid-cols-4 gap-2 mb-3 bg-gray-50 p-2 rounded">
                    {[
                      {k: 'isRepro', l: '再現'}, {k: 'isSimple', l: '簡単'}, 
                      {k: 'isSafe', l: '安全'}, {k: 'isValue', l: '価値'}
                    ].map(item => (
                      <label key={item.k} className="flex flex-col items-center cursor-pointer">
                        <span className="text-[10px] text-gray-600 mb-1">{item.l}</span>
                        <input 
                          type="checkbox" 
                          checked={task[item.k]} 
                          onChange={(e) => updateTask(task.id, item.k, e.target.checked)}
                          className="w-4 h-4 text-green-600 rounded"
                        />
                      </label>
                    ))}
                  </div>

                  <div className="grid grid-cols-2 gap-3 mb-2">
                    <div>
                      <label className="text-[10px] text-gray-500">作業者 / 時給</label>
                      <div className="flex gap-2">
                        <input 
                          type="text" className="w-1/2 text-sm border rounded p-1" placeholder="誰"
                          value={task.worker} onChange={(e) => updateTask(task.id, 'worker', e.target.value)}
                        />
                        <input 
                          type="number" className="w-1/2 text-sm border rounded p-1" placeholder="円"
                          value={task.wage} onChange={(e) => updateTask(task.id, 'wage', e.target.value)}
                        />
                      </div>
                    </div>
                    <div>
                      <label className="text-[10px] text-gray-500">1H作業量 / 単位</label>
                      <div className="flex gap-1">
                        <input 
                          type="number" className="w-2/3 text-sm border rounded p-1" placeholder="量"
                          value={task.amount} onChange={(e) => updateTask(task.id, 'amount', e.target.value)}
                        />
                        <input 
                          type="text" className="w-1/3 text-sm border rounded p-1" placeholder="個"
                          value={task.unit} onChange={(e) => updateTask(task.id, 'unit', e.target.value)}
                        />
                      </div>
                    </div>
                  </div>

                  <div className="flex justify-between items-center bg-gray-50 p-2 rounded mt-2">
                    <div className="text-xs text-gray-500">単位コスト算出</div>
                    <div className="text-xl font-bold text-gray-800">
                      {calculateCost(task.wage, task.amount) ? `¥${calculateCost(task.wage, task.amount)}` : '---'}
                    </div>
                    <div className="text-sm font-bold text-green-700 bg-white px-2 py-1 rounded border border-green-200">
                      判定: {getJudgment(task)}
                    </div>
                  </div>
                </div>
              ))}
            </div>

            <button 
              onClick={addTask} 
              className="w-full py-3 bg-gray-800 text-white rounded-lg shadow hover:bg-gray-700 flex justify-center items-center gap-2 transition"
            >
              <IconPlus /> 作業を追加する
            </button>
          </section>

          {/* 3. 外注計画入力 */}
          <section className="bg-white p-4 rounded-lg shadow border border-gray-200">
             <h2 className="text-green-800 font-bold border-b border-gray-200 pb-2 mb-4 flex items-center gap-2">
                <IconCheckSquare />【外注計画】ターゲット設定
             </h2>
             <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div className="bg-gray-50 p-3 rounded border border-gray-200">
                  <label className="text-xs font-bold text-gray-700 block mb-2">依頼する作業・時期・時間</label>
                  <div className="space-y-3">
                    <div>
                        <span className="text-xs text-gray-500 mb-1 block">作業名 (上のリストで「依頼」チェックを付けると自動反映されます)</span>
                        <input 
                        className="w-full border p-2 text-sm rounded bg-white" placeholder="作業名"
                        value={meta.planTask} onChange={(e) => updateMeta('planTask', e.target.value)}
                        />
                    </div>
                    <div className="flex flex-wrap items-center gap-4 text-sm">
                      <div className="flex items-center gap-2">
                        <span className="text-xs font-bold">時期:</span>
                        <input type="number" className="w-12 border p-1 rounded bg-white" value={meta.planMonthStart} onChange={(e)=>updateMeta('planMonthStart', e.target.value)}/>月 ～ 
                        <input type="number" className="w-12 border p-1 rounded bg-white" value={meta.planMonthEnd} onChange={(e)=>updateMeta('planMonthEnd', e.target.value)}/>月
                      </div>
                      <div className="flex items-center gap-2">
                        <IconClock />
                        <span className="text-xs font-bold">時間帯:</span>
                        <input type="time" className="border p-1 rounded bg-white" value={meta.planTimeStart} onChange={(e)=>updateMeta('planTimeStart', e.target.value)}/> ～ 
                        <input type="time" className="border p-1 rounded bg-white" value={meta.planTimeEnd} onChange={(e)=>updateMeta('planTimeEnd', e.target.value)}/>
                      </div>
                    </div>
                    <div className="flex gap-3 text-sm flex-wrap pt-2 border-t border-gray-200">
                       <label className="flex items-center"><input type="radio" name="freq" className="mr-1" onChange={()=>updateMeta('planFreqType', 'daily')} checked={meta.planFreqType === 'daily'}/>毎日</label>
                       <label className="flex items-center"><input type="radio" name="freq" className="mr-1" onChange={()=>updateMeta('planFreqType', 'weekly')} checked={meta.planFreqType === 'weekly'}/>週( <input type="number" className="w-8 border-b border-gray-400 mx-1 bg-transparent" value={meta.planFreqCount} onChange={(e)=>updateMeta('planFreqCount', e.target.value)}/> )回</label>
                       <label className="flex items-center"><input type="radio" name="freq" className="mr-1" onChange={()=>updateMeta('planFreqType', 'single')} checked={meta.planFreqType === 'single'}/>単発</label>
                    </div>
                  </div>
                </div>
                <div className="bg-green-50 p-3 rounded border border-green-200">
                   <label className="text-xs font-bold text-green-800 block mb-2">目標と期待効果</label>
                   <div className="space-y-3">
                     <div className="flex items-center gap-2">
                        <span className="text-sm">目標単価:</span>
                        <input type="number" className="w-24 border p-1 rounded text-right bg-white" placeholder="0" value={meta.targetPrice} onChange={(e)=>updateMeta('targetPrice', e.target.value)}/>
                        <span className="text-xs text-gray-500">円/個</span>
                     </div>
                     <div className="flex items-center gap-2">
                        <span className="text-sm">創出時間: 月間</span>
                        <input type="number" className="w-20 border p-1 rounded text-right font-bold text-green-700 bg-white" placeholder="0" value={meta.savedHours} onChange={(e)=>updateMeta('savedHours', e.target.value)}/>
                        <span className="text-sm">時間</span>
                     </div>
                     <p className="text-[10px] text-green-700 font-bold mt-2">→ この時間を、経営目標の達成に使います。</p>
                   </div>
                </div>
             </div>
          </section>

        </main>
      </div>


      {/* === 印刷専用ビュー (画面上は非表示、印刷時のみCSSで整形して表示) === */}
      <div className="hidden print:block print:w-full bg-white text-black p-0 m-0">
        <style>{`
          @media print {
            @page { size: A4 landscape; margin: 8mm; }
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; background: white; }
            .print-border { border: 1px solid #333; }
            .print-bg-header { background-color: #166534 !important; color: white !important; }
            .print-bg-gray { background-color: #f3f4f6 !important; }
            .print-bg-hint { background-color: #f0fdf4 !important; }
            .print-bg-check { background-color: #f0fdf4 !important; }
            /* 印刷時にチェックボックスの見た目を整える */
            input[type="checkbox"] { border: 1px solid #333; -webkit-appearance: none; appearance: none; width: 10px; height: 10px; display: inline-block; }
            input[type="checkbox"]:checked { background-color: #333; }
          }
        `}</style>

        {/* Header */}
        <div className="flex justify-between items-end mb-4">
            <div className="w-1/2">
                <div className="print-bg-header text-xl mb-3 p-2 font-bold text-center rounded">農作業分解・外注シミュレーションシート</div>
                <div className="flex gap-4 mb-2">
                    <div className="flex-1 border-b border-black text-sm pb-1">品目名： <span className="font-bold text-base ml-2">{meta.crop}</span></div>
                    <div className="flex-1 border-b border-black text-sm pb-1">氏名： <span className="font-bold text-base ml-2">{meta.name}</span></div>
                </div>
            </div>
            <div className="w-2/5 text-right text-[10px] leading-tight">
                <strong>【経営目標】</strong><br/>
                <div className="mt-1 min-h-[32px] border-b border-black bg-gray-50 text-left p-1 text-sm">{meta.goal}</div>
            </div>
        </div>

        <div className="border-2 border-dashed border-green-700 p-2 mb-2 text-xs">
            <strong>【目的】</strong> 作業を細かく分解（MECE）し、経営者の高価な時間を「誰でもできる単純作業」に使っていないか、数値で確認しましょう。
        </div>

        <div className="flex gap-4">
            {/* 左カラム：ヒント */}
            <div className="w-1/4">
                <table className="w-full border-collapse border border-black h-full">
                    <thead><tr><th className="print-bg-gray border border-black py-1 text-xs">外注可否の判定基準</th></tr></thead>
                    <tbody className="text-[9px]">
                        <tr>
                            <td className="print-bg-hint p-2 align-top h-full border border-black">
                                <p className="mb-1 font-bold">● 再現性</p><p className="mb-2 text-gray-600">誰がやっても同じ結果になるか？</p>
                                <p className="mb-1 font-bold">● 判断不要</p><p className="mb-2 text-gray-600">迷いや長年の勘が不要か？</p>
                                <p className="mb-1 font-bold">● 安全</p><p className="mb-2 text-gray-600">危険な機械や刃物を使わないか？</p>
                                <p className="mb-1 font-bold">● 人手価値</p><p className="text-gray-600">数でこなすことで価値が出るか？</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            {/* 右カラム：テーブル */}
            <div className="w-3/4">
                <table className="w-full border-collapse border border-black text-center">
                    <thead>
                        <tr className="print-bg-gray text-[10px]">
                            <th rowSpan="2" className="border border-black w-3/12 py-2">作業工程を細かく記入</th>
                            <th colSpan="4" className="border border-black py-1">適性チェック</th>
                            <th colSpan="4" className="border border-black py-1">現在のコスト「見える化」</th>
                            <th rowSpan="2" className="border border-black w-8 bg-green-100">外注<br/>可否</th>
                            <th rowSpan="2" className="border border-black w-8 print-bg-check">依頼</th>
                        </tr>
                        <tr className="print-bg-gray text-[8px]">
                            <th className="border border-black w-5">再現</th>
                            <th className="border border-black w-5">単純</th>
                            <th className="border border-black w-5">安全</th>
                            <th className="border border-black w-5">価値</th>
                            <th className="border border-black w-20">作業者/時給</th>
                            <th className="border border-black w-10">1H量</th>
                            <th className="border border-black w-10">単位</th>
                            <th className="border border-black w-12">単価</th>
                        </tr>
                    </thead>
                    <tbody>
                        {tasks.map((task, idx) => (
                          <tr key={idx} className="h-10 text-[10px]">
                            <td className="border border-black text-left px-2">{task.name}</td>
                            <td className="border border-black">{task.isRepro ? '○' : ''}</td>
                            <td className="border border-black">{task.isSimple ? '○' : ''}</td>
                            <td className="border border-black">{task.isSafe ? '○' : ''}</td>
                            <td className="border border-black">{task.isValue ? '○' : ''}</td>
                            <td className="border border-black text-[9px]">
                                {task.worker && <div>{task.worker}</div>}
                                {task.wage && <div>@{task.wage}</div>}
                            </td>
                            <td className="border border-black">{task.amount}</td>
                            <td className="border border-black">{task.unit}</td>
                            <td className="border border-black font-bold">
                                {calculateCost(task.wage, task.amount) ? `¥${calculateCost(task.wage, task.amount)}` : ''}
                            </td>
                            <td className="border border-black text-sm">{getJudgment(task)}</td>
                            <td className="border border-black text-lg print-bg-check font-bold">{task.isRequest ? '✔' : ''}</td>
                          </tr>
                        ))}
                        {/* 空行の補充 (印刷時に見栄え良くするため、最低10行確保) */}
                        {Array.from({ length: Math.max(0, 10 - tasks.length) }).map((_, i) => (
                           <tr key={`empty-${i}`} className="h-10 text-[10px]">
                              <td className="border border-black"></td>
                              <td className="border border-black"></td>
                              <td className="border border-black"></td>
                              <td className="border border-black"></td>
                              <td className="border border-black"></td>
                              <td className="border border-black"></td>
                              <td className="border border-black"></td>
                              <td className="border border-black"></td>
                              <td className="border border-black"></td>
                              <td className="border border-black"></td>
                              <td className="border border-black print-bg-check"></td>
                           </tr>
                        ))}
                    </tbody>
                </table>

                {/* Footer Analysis */}
                <div className="mt-4 grid grid-cols-2 gap-4">
                    <div className="border-2 border-gray-800 p-2 text-[10px]">
                        <div className="bg-gray-800 text-white font-bold p-1 mb-2 text-center">外注計画</div>
                        <div className="mb-2">作業名：<span className="font-bold ml-2 text-sm">{meta.planTask}</span></div>
                        <div className="mb-2">
                          時期： <span className="font-bold mx-1">{meta.planMonthStart}</span>月 ～ <span className="font-bold mx-1">{meta.planMonthEnd}</span>月
                          <span className="ml-4">時間： <span className="font-bold">{meta.planTimeStart}</span> ～ <span className="font-bold">{meta.planTimeEnd}</span></span>
                        </div>
                        <div className="flex gap-2">
                            <span>頻度：</span>
                            <span className={meta.planFreqType === 'daily' ? 'font-bold underline' : ''}>□毎日</span>
                            <span className={meta.planFreqType === 'weekly' ? 'font-bold underline' : ''}>□週({meta.planFreqCount})回</span>
                            <span className={meta.planFreqType === 'single' ? 'font-bold underline' : ''}>□単発</span>
                        </div>
                    </div>
                    <div className="border-2 border-green-800 p-2 bg-green-50 text-[10px]">
                        <div className="bg-green-800 text-white font-bold p-1 mb-2 text-center">目標と期待効果</div>
                        <div className="mb-2">目標支払単価：<span className="font-bold text-sm ml-2">{meta.targetPrice}</span> 円</div>
                        <div className="mb-1">
                            創出時間：月間 <span className="font-bold text-sm ml-2">{meta.savedHours}</span> 時間
                        </div>
                        <p className="text-green-800 font-bold mt-1">→ 経営目標達成のために活用します。</p>
                    </div>
                </div>
            </div>
        </div>
      </div>
    </div>
  );
}
